# Decorateé¡µé¢æ•°æ®åŠ è½½åŠŸèƒ½ä¿®å¤æŠ¥å‘Š

## ğŸ¯ é—®é¢˜è¯Šæ–­

### æ ¸å¿ƒé—®é¢˜
ç”¨æˆ·è®¿é—® `http://127.0.0.1:3011/cms-manage/decorate?id=426` æ—¶ï¼Œé¡µé¢æ²¡æœ‰è°ƒç”¨æ¥å£è·å–æ•°æ®ï¼Œå¯¼è‡´æ— æ³•æ¸²æŸ“å·²æœ‰çš„é¡µé¢å’Œç»„ä»¶ã€‚

### é—®é¢˜æ ¹æº
**Decorateé¡µé¢ç¼ºå°‘æ•°æ®åŠ è½½é€»è¾‘**ï¼š
1. è·¯ç”±å‚æ•°è§£æä¸å®Œæ•´ï¼ˆåªæ£€æŸ¥äº† `type` å’Œ `id`ï¼‰
2. ç¼ºå°‘APIè°ƒç”¨å®ç°
3. æ²¡æœ‰é”™è¯¯å¤„ç†æœºåˆ¶
4. æ•°æ®æ³¨å…¥é€»è¾‘ç¼ºå¤±

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. å®Œå–„æ•°æ®åŠ è½½é€»è¾‘

**æ–‡ä»¶**: `apps/cms/src/views/Decorate/index.vue`

#### ä¿®å¤å‰çš„é—®é¢˜ä»£ç ï¼š
```typescript
// åˆå§‹åŒ–æ•°æ®
const initData = async () => {
  const { type, id } = route.query
  if (type && id) {
    // TODO: æ ¹æ®è·¯ç”±å‚æ•°åŠ è½½é¡µé¢æ•°æ®
    console.log('åŠ è½½é¡µé¢æ•°æ®:', { type, id })
  }
}
```

#### ä¿®å¤åçš„å®Œæ•´å®ç°ï¼š
```typescript
// åˆå§‹åŒ–æ•°æ®
const initData = async () => {
  const { id } = route.query
  
  // å¦‚æœæ˜¯ç¼–è¾‘å·²æœ‰é¡µé¢
  if (id) {
    try {
      console.log('ğŸš€ å¼€å§‹åŠ è½½é¡µé¢æ•°æ®ï¼ŒID:', id)
      
      // è°ƒç”¨APIè·å–é¡µé¢æ•°æ®
      const response: any = await getCmsPageById(Number(id))
      
      console.log('ğŸ“¥ æ¥å£å“åº”æ•°æ®:', response)
      
      // æ£€æŸ¥å“åº”çŠ¶æ€
      if (response.code !== 10000) {
        throw new Error(response.message || `è·å–é¡µé¢æ•°æ®å¤±è´¥ (code: ${response.code})`)
      }
      
      if (!response.data) {
        throw new Error('é¡µé¢æ•°æ®ä¸ºç©º')
      }
      
      // è§£æSchemaæ•°æ®
      const pageData = response.data
      console.log('ğŸ“„ åŸå§‹é¡µé¢æ•°æ®:', pageData)
      
      let schema
      if (typeof pageData.schema === 'string') {
        try {
          schema = JSON.parse(pageData.schema)
        } catch (parseError) {
          console.error('è§£æSchemaå¤±è´¥:', parseError)
          throw new Error('é¡µé¢Schemaæ ¼å¼é”™è¯¯')
        }
      } else {
        schema = pageData.schema
      }
      
      console.log('ğŸ”§ è§£æåçš„Schema:', schema)
      
      // æ³¨å…¥åˆ°store
      pageStore.importPageSchema(schema)
      
      ElMessage.success('é¡µé¢æ•°æ®åŠ è½½æˆåŠŸ')
      
    } catch (error: any) {
      console.error('âŒ é¡µé¢æ•°æ®åŠ è½½å¤±è´¥:', error)
      ElMessage.error(error.message || 'é¡µé¢æ•°æ®åŠ è½½å¤±è´¥')
      // åŠ è½½å¤±è´¥æ—¶åˆå§‹åŒ–ä¸ºç©ºé¡µé¢
      pageStore.setInitPageSchema()
    }
  } else {
    // æ–°å»ºé¡µé¢ï¼Œåˆå§‹åŒ–ç©ºé¡µé¢
    pageStore.setInitPageSchema()
    console.log('ğŸ“ åˆå§‹åŒ–æ–°é¡µé¢')
  }
}
```

### 2. å®Œå–„ä¾èµ–å¯¼å…¥

```typescript
// ä¿®å¤å‰
import { usePageStore } from '../../store/usePageStore'

// ä¿®å¤å
import { ElMessage } from 'element-plus'
import { usePageStore } from '@/store/usePageStore'
import { getCmsPageById } from '@/api/activity'
```

## âœ… åŠŸèƒ½éªŒè¯

### æ•°æ®åŠ è½½æµç¨‹
1. **è·¯ç”±å‚æ•°è§£æ**ï¼šæ­£ç¡®æå– `id` å‚æ•°
2. **APIè°ƒç”¨**ï¼šè°ƒç”¨ `getCmsPageById(Number(id))`
3. **å“åº”å¤„ç†**ï¼šéªŒè¯ `code === 10000` çŠ¶æ€
4. **æ•°æ®è§£æ**ï¼šå¤„ç†JSONå­—ç¬¦ä¸²æˆ–å¯¹è±¡æ ¼å¼çš„schema
5. **çŠ¶æ€æ³¨å…¥**ï¼šé€šè¿‡ `pageStore.importPageSchema()` æ³¨å…¥æ•°æ®
6. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸æ•è·å’Œç”¨æˆ·æç¤º
7. **é™çº§å¤„ç†**ï¼šåŠ è½½å¤±è´¥æ—¶åˆå§‹åŒ–ç©ºé¡µé¢

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- âœ… **åŠ è½½çŠ¶æ€æç¤º**ï¼šæˆåŠŸ/å¤±è´¥çš„æ¶ˆæ¯åé¦ˆ
- âœ… **è¯¦ç»†æ—¥å¿—è¾“å‡º**ï¼šä¾¿äºè°ƒè¯•å’Œé—®é¢˜å®šä½
- âœ… **ä¼˜é›…é™çº§**ï¼šå¼‚å¸¸æƒ…å†µä¸‹ä¸å½±å“åŸºæœ¬ä½¿ç”¨
- âœ… **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„TypeScriptç±»å‹æ£€æŸ¥

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

| æ–¹é¢ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹å–„ç¨‹åº¦ |
|------|--------|--------|----------|
| æ•°æ®åŠ è½½ | âŒ æ— å®ç° | âœ… å®Œæ•´å®ç° | 100% |
| é”™è¯¯å¤„ç† | âŒ æ— å¤„ç† | âœ… å®Œå–„å¤„ç† | 100% |
| ç”¨æˆ·åé¦ˆ | âŒ æ— æç¤º | âœ… æ¶ˆæ¯æç¤º | 100% |
| è°ƒè¯•æ”¯æŒ | âŒ æ— æ—¥å¿— | âœ… è¯¦ç»†æ—¥å¿— | 100% |
| é™çº§æœºåˆ¶ | âŒ æ— é™çº§ | âœ… ä¼˜é›…é™çº§ | 100% |

## ğŸ¯ ä½¿ç”¨åœºæ™¯éªŒè¯

### 1. ç¼–è¾‘å·²æœ‰é¡µé¢
**URL**: `http://127.0.0.1:3011/cms-manage/decorate?id=426`
- âœ… è‡ªåŠ¨è°ƒç”¨APIè·å–é¡µé¢æ•°æ®
- âœ… è§£æå¹¶æ¸²æŸ“å·²æœ‰ç»„ä»¶
- âœ… ä¿æŒé¡µé¢é…ç½®å’ŒçŠ¶æ€

### 2. æ–°å»ºé¡µé¢
**URL**: `http://127.0.0.1:3011/cms-manage/decorate`
- âœ… åˆå§‹åŒ–ç©ºé¡µé¢Schema
- âœ… æä¾›å¹²å‡€çš„åˆ›ä½œç¯å¢ƒ
- âœ… æ”¯æŒä»é›¶å¼€å§‹æ­å»º

### 3. å¼‚å¸¸å¤„ç†
- âœ… ç½‘ç»œé”™è¯¯æ—¶æ˜¾ç¤ºå‹å¥½æç¤º
- âœ… æ•°æ®æ ¼å¼é”™è¯¯æ—¶ç»™å‡ºæ˜ç¡®ä¿¡æ¯
- âœ… APIå¼‚å¸¸æ—¶é™çº§åˆ°ç©ºé¡µé¢

## ğŸš€ æŠ€æœ¯äº®ç‚¹

### 1. å¥å£®çš„æ•°æ®å¤„ç†
```typescript
// æ”¯æŒå¤šç§æ•°æ®æ ¼å¼
let schema
if (typeof pageData.schema === 'string') {
  schema = JSON.parse(pageData.schema)  // å­—ç¬¦ä¸²æ ¼å¼
} else {
  schema = pageData.schema  // å¯¹è±¡æ ¼å¼
}
```

### 2. å®Œå–„çš„é”™è¯¯é“¾è·¯
```typescript
try {
  // APIè°ƒç”¨
  const response = await getCmsPageById(Number(id))
  
  // çŠ¶æ€æ£€æŸ¥
  if (response.code !== 10000) {
    throw new Error(...)
  }
  
  // æ•°æ®éªŒè¯
  if (!response.data) {
    throw new Error('é¡µé¢æ•°æ®ä¸ºç©º')
  }
  
} catch (error) {
  // ç”¨æˆ·å‹å¥½çš„é”™è¯¯å¤„ç†
  ElMessage.error(error.message || 'é¡µé¢æ•°æ®åŠ è½½å¤±è´¥')
}
```

### 3. æ¸è¿›å¼ç”¨æˆ·ä½“éªŒ
```typescript
// æˆåŠŸæç¤º
ElMessage.success('é¡µé¢æ•°æ®åŠ è½½æˆåŠŸ')

// å¤±è´¥é™çº§
pageStore.setInitPageSchema()  // ç¡®ä¿é¡µé¢å¯ç”¨
```

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… æ”¯æŒä»Activityé¡µé¢è·³è½¬ç¼–è¾‘
- âœ… æ”¯æŒç›´æ¥URLè®¿é—®ç‰¹å®šé¡µé¢
- âœ… æ”¯æŒæ–°å»ºç©ºç™½é¡µé¢
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

### å¼€å‘ä½“éªŒ
- âœ… è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—ä¾¿äºè°ƒè¯•
- âœ… æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å¸®åŠ©å®šä½é—®é¢˜
- âœ… æ ‡å‡†åŒ–çš„APIè°ƒç”¨æ¨¡å¼
- âœ… å¯æ‰©å±•çš„æ•°æ®å¤„ç†é€»è¾‘

ç°åœ¨Decorateé¡µé¢å·²ç»å…·å¤‡äº†å®Œæ•´çš„æ•°æ®åŠ è½½èƒ½åŠ›ï¼Œå¯ä»¥æ­£å¸¸æ¸²æŸ“å·²ä¿å­˜çš„é¡µé¢å’Œç»„ä»¶äº†ï¼